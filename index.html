<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í˜¼ë°¥ëŸ¬ Â· í™ˆ</title>
    <link rel="stylesheet" href="style.css?v=31" />
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸš</div>
            <h1 class="title">í˜¼ë°¥ëŸ¬ Â· í™ˆ</h1>
        </div>

        <div class="card">
            <div class="row" style="gap:16px">
                <a class="link-btn" href="match.html" style="flex:1;text-align:center">
                    <div>í˜¼ë°¥ëŸ¬ ë§¤ì¹­</div><div class="muted">ë°”ë¡œ ì‹œì‘</div>
                </a>
                <a class="link-btn" href="community.html" style="flex:1;text-align:center">
                    <div>ì»¤ë®¤ë‹ˆí‹°</div><div class="muted">ê¸€/ëŒ“ê¸€/ì¢‹ì•„ìš”</div>
                </a>
                <a class="link-btn" href="profile.html" style="flex:1;text-align:center">
                    <div>ë‚´ í”„ë¡œí•„</div><div class="muted">ì •ë³´ ìˆ˜ì •</div>
                </a>
            </div>
        </div>

        <div class="card">
            <h3 style="margin:0 0 10px">ë¬´ìŠ¨ ìƒê° ì¤‘ì´ì—ìš”?</h3>
            <label>ì œëª©</label>
            <input id="homeTitle" type="text" placeholder="ì˜ˆ: ì˜¤ëŠ˜ ì €ë… ì¶”ì²œ" />
            <label>ë‚´ìš©</label>
            <div class="row">
                <input id="homeText" type="text" placeholder="ì§§ì•„ë„ ì¢‹ì•„ìš”! ê°„ë‹¨ ë©”ëª¨" />
                <button id="homePostBtn" class="btn" style="width:auto;min-width:90px">ë“±ë¡</button>
            </div>
            <p id="homeMsg" class="status"></p>
            <p class="muted">ì „ì²´ ê¸€ì“°ê¸°ëŠ” ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë³¼ ìˆ˜ ìˆì–´ìš”.</p>
        </div>

        <div class="card">
            <div class="topbar" style="margin:0 0 6px">
                <h3 class="title" style="font-size:18px;margin:0">ìµœì‹  ê¸€</h3>
                <a class="link-btn" href="community.html">ë” ë³´ê¸°</a>
            </div>
            <div id="recentPosts"></div>
        </div>
    </div>

    <script type="module" src="./firebase.js?v=31"></script>
    <script type="module">
        const $ = (s) => document.querySelector(s);
        const msg = $("#homeMsg");
        const setMsg = (t, ok = false) => { msg.className = "status " + (ok ? "ok" : "err"); msg.textContent = t; };

        if (window.fbReady) await window.fbReady;

        // ìµœì‹  ê¸€ 5ê°œ í‘œì‹œ
        async function loadRecent() {
            try {
                const arr = await window.fb.listPosts({ limitCount: 5 });
                const box = $("#recentPosts");
                box.innerHTML = arr.map(p => {
                    const when = p.createdAt?.toDate?.() ? p.createdAt.toDate().toLocaleString() : "";
                    const title = (p.title || "").replace(/</g, "&lt;");
                    const body = (p.body || "").replace(/</g, "&lt;");
                    return `<div style="padding:10px;border:1px solid #22283a;border-radius:10px;margin:8px 0;background:#0e1322">
                        <div style="font-weight:700">${title}</div>
                        <div class="muted" style="font-size:12px">${when}</div>
                        <div style="margin-top:6px">${body}</div>
                      </div>`;
                }).join("") || `<p class="muted">ì•„ì§ ê¸€ì´ ì—†ì–´ìš”.</p>`;
            } catch (e) {
                console.error(e);
            }
        }
        loadRecent();

        // í™ˆì—ì„œ ê°„ë‹¨ ê¸€ ë“±ë¡
        $("#homePostBtn").addEventListener("click", async () => {
            try {
                msg.className = "status"; msg.textContent = "";
                const title = String($("#homeTitle").value ?? "");  // â¬… ë¬¸ìì—´ ë³´ì¥
                const text = String($("#homeText").value ?? "");
                await window.fb.createPost(title, text);
                setMsg("ë“±ë¡ ì™„ë£Œ!", true);
                $("#homeTitle").value = ""; $("#homeText").value = "";
                loadRecent();
            } catch (e) {
                setMsg((e && e.message) ? e.message : String(e));
            }
        });
    </script>
</body>
</html>
