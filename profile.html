<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í˜¼ë°¥ëŸ¬ Â· í”„ë¡œí•„</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="container">
        <div class="topbar">
            <div class="header" style="margin:0">
                <div class="logo">ğŸš</div>
                <h1 class="title">í˜¼ë°¥ëŸ¬ Â· í”„ë¡œí•„</h1>
            </div>
            <a id="logout" class="link-btn" href="#">ë¡œê·¸ì•„ì›ƒ</a>
        </div>

        <div class="card">
            <p class="muted">ë¡œê·¸ì¸ ì´ë©”ì¼: <span id="emailTxt"></span></p>

            <label>í•™ë²ˆ(ì…í•™ë…„ë„)</label>
            <input id="year" type="number" placeholder="ì˜ˆ: 23" />

            <label>ë‚˜ì´(ë§Œ)</label>
            <input id="age" type="number" placeholder="ì˜ˆ: ë§Œ ë‚˜ì´ ì…ë ¥" />

            <label>ì„±ë³„</label>
            <select id="gender">
                <option value="">ì„ íƒ</option>
                <option value="ë‚¨">ë‚¨</option>
                <option value="ì—¬">ì—¬</option>
                <option value="ê¸°íƒ€/ì‘ë‹µì•ˆí•¨">ê¸°íƒ€/ì‘ë‹µì•ˆí•¨</option>
            </select>

            <label>í•™ê³¼</label>
            <input id="major" type="text" placeholder="ì˜ˆ: ì†Œí”„íŠ¸ì›¨ì–´í•™ë¶€" />

            <label>MBTI</label>
            <input id="mbti" type="text" placeholder="ì˜ˆ: INTP" />

            <label>í˜¼ë°¥ ë•Œ ì£¼ë¡œ ì†Œë¹„ ì½˜í…ì¸ </label>
            <input id="content" type="text" placeholder="ì˜ˆ: ìœ íŠœë¸Œ, íŒŸìºìŠ¤íŠ¸, ìŒì•…" />

            <label>ê³µê°•ì‹œê°„ (ì½¤ë§ˆë¡œ êµ¬ë¶„, ì˜ˆ: ì›” 12-15, í™” 9-11)</label>
            <textarea id="freeText" rows="3" placeholder="ì›” 12-15, í™” 9-11"></textarea>

            <button id="saveBtn" class="btn">í”„ë¡œí•„ ì €ì¥</button>
            <p id="msg" class="status"></p>

            <div class="hr"></div>
            <div class="nav">
                <a class="link-btn" href="index.html">í™ˆ</a>
                <a class="link-btn" href="match.html">ë§¤ì¹­</a>
            </div>
        </div>
    </div>

    <script type="module" src="./firebase.js?v=fix-undefined"></script>
    <script type="module">
        const $ = (s) => document.querySelector(s);
        const msg = $("#msg");

        (async () => {
            try {
                const user = await window.fb.requireAuth();
                $("#emailTxt").textContent = user.email || "";
                const data = await window.fb.loadProfile().catch(() => null);
                if (data) {
                    $("#year").value = data.year ?? "";
                    $("#age").value = data.age ?? "";
                    $("#gender").value = data.gender ?? "";
                    $("#major").value = data.major ?? "";
                    $("#mbti").value = data.mbti ?? "";
                    $("#content").value = data.content ?? "";
                    $("#freeText").value = data.freeText ?? "";
                }
            } catch (e) {
                msg.className = "status err";
                msg.textContent = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
                setTimeout(() => location.href = "login.html", 600);
            }
        })();

        $("#logout")?.addEventListener("click", async (e) => {
            e.preventDefault();
            await window.fb.logout().catch(() => { });
            location.href = "login.html";
        });

        $("#saveBtn")?.addEventListener("click", async () => {
            try {
                msg.className = "status"; msg.textContent = "";
                const payload = {
                    year: $("#year").value,
                    age: $("#age").value,
                    gender: $("#gender").value,
                    major: $("#major").value,
                    mbti: $("#mbti").value,
                    content: $("#content").value,
                    freeText: $("#freeText").value
                };
                await window.fb.saveProfile(payload);
                msg.className = "status ok";
                msg.textContent = "í”„ë¡œí•„ ì €ì¥ ì™„ë£Œ!";
            } catch (e) {
                msg.className = "status err";
                msg.textContent = "ì €ì¥ ì‹¤íŒ¨: " + (e.message || e);
            }
        });
    </script>
</body>
</html>
